#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∫–ª–∏–∫–µ—Ä–∞ –Ω–∞ VPS —Å–µ—Ä–≤–µ—Ä
# –ó–∞–ø—É—Å–∫–∞—Ç—å —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞

SERVER_IP="77.222.42.53"
SERVER_USER="root"
SERVER_PASSWORD="TyqXum*tBdg3e4T7"

echo "üì§ –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–µ–∫—Ç –∫–ª–∏–∫–µ—Ä–∞ –Ω–∞ VPS —Å–µ—Ä–≤–µ—Ä..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–∞–ø–∫–µ
if [ ! -f "deploy.sh" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –ø–∞–ø–∫–∏ —Å –ø—Ä–æ–µ–∫—Ç–æ–º (–≥–¥–µ –µ—Å—Ç—å deploy.sh)"
    exit 1
fi

# –°–æ–∑–¥–∞—ë–º –∞—Ä—Ö–∏–≤ –ø—Ä–æ–µ–∫—Ç–∞
echo "üì¶ –°–æ–∑–¥–∞—ë–º –∞—Ä—Ö–∏–≤ –ø—Ä–æ–µ–∫—Ç–∞..."
tar -czf clicker-project.tar.gz \
    backend/ \
    frontend/ \
    deploy/ \
    deploy.sh \
    README.md \
    upload_to_server.sh

echo "üìã –§–∞–π–ª—ã –≤ –∞—Ä—Ö–∏–≤–µ:"
tar -tzf clicker-project.tar.gz

# –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–º–æ—â—å—é scp
echo "üöÄ –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä $SERVER_IP..."
echo "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å: $SERVER_PASSWORD"

scp clicker-project.tar.gz root@$SERVER_IP:/tmp/

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º
echo "üìÇ –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."

ssh root@$SERVER_IP << 'EOF'
cd /tmp
tar -xzf clicker-project.tar.gz
chmod +x deploy.sh

echo "‚úÖ –ü—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ /tmp/"
echo "üìç –¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏—Ç–µ: cd /tmp && ./deploy.sh"
EOF

# –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∞—Ä—Ö–∏–≤
rm clicker-project.tar.gz

echo ""
echo "üéâ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üì° –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:"
echo "   1. ssh root@$SERVER_IP"
echo "   2. cd /tmp"
echo "   3. ./deploy.sh"
echo ""
echo "üåê –ü–æ—Å–ª–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω:"
echo "   http://$SERVER_IP" 